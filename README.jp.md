# シャットダウンタスクスクリプト

このスクリプトは、指定されたディレクトリ内の指示書ファイルを処理し、ファイル内容に基づいてシャットダウンタスクを実行します。

## 動作環境

- windows11
- [uv](https://docs.astral.sh/uv/getting-started/installation/#winget)

note:uvを要求しているのは、指示書ファイルをもとに実際に実行するスクリプトをPythonのpackageマネージャーであるuvが実行しているからです。
よって、起動したいスクリプトにシェルスクリプトや他のスクリプト言語を使用する場合には必要ありません。

## 使用方法

1. **ディレクトリ構造のセットアップ**:
   - スクリプト（`shutdown.ps1`）を任意のディレクトリに配置します。
   - 以下のサブディレクトリが存在することを確認してください:
     - `shutdown_tasks`: 指示書ファイルを格納するディレクトリ。
     - `shutdown_tasks/archive`: 処理済みファイルをアーカイブするディレクトリ。

2. **指示書ファイルの形式**:
   - ファイル名は以下の形式に従う必要があります: `<priority>_<count>_<days>_<identifier>.txt`
     - `priority`: 高優先度の場合は `h`、通常優先度の場合は `n`。
     - `count`: タスクを実行する回数（無限の場合は `p`）。
     - `days`: タスクを実行する曜日（例: `123` は月曜、火曜、水曜）。
     - `identifier`: タスクの一意の識別子。
   - ファイルの1行目には実行するコマンドを記述してください。

3. **実行**:
   - PowerShell を使用してスクリプトを実行します:

     ```powershell
     .\shutdown.ps1
     ```

   - スクリプトの動作:
     - 高優先度ファイル（`h_*`）を最初に処理し、その後通常優先度ファイル（`n_*`）を処理します。
     - 現在の日付が指定された曜日に一致する場合、ファイルの1行目に記載されたコマンドを実行します。
     - ファイル名の `count` を更新するか、`count` がゼロになった場合はファイルを `archive` ディレクトリに移動します。

4. **ログ**:
   - ログは `shutdown_tasks/shutdown_task_log.txt` に記録されます。
   - ログには、処理されたファイル、スキップされたファイル、およびエラー情報が含まれます。

5. **シャットダウン**:
   - すべてのファイルを処理した後、スクリプトは10秒後にシステムシャットダウンを開始します。
   - シャットダウンを無効にするには、スクリプト内の以下の行をコメントアウトしてください:

     ```powershell
     #shutdown.exe /s /t 10
     ```

## 注意事項

- スクリプトが `shutdown_tasks` ディレクトリ内のファイルを読み取り、書き込み、実行するための必要な権限を持っていることを確認してください。
- 本番環境に導入する前に、安全な環境でスクリプトをテストしてください。
